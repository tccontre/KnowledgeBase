__author__ = "tccontre18 - Br3akp0int"

"""
malware     : AgentTesla Loader
analyzed by : tccontre18 - Br3akp0int
description : a short python script to deobfuscate the function loader of the
             Agent Tesla
"""

import os
import gzip

def main():
    with open("agent.bin", "wb") as f:
        ## put the comple array byte of obfuscated agentesla in variable "byte_arr_agent"
        ## array byte is in "$zmOo" relative to this samples set
        ## sha256: 683fb58ed87ad8bafeac143c69fa5b09aa40cf02b3fb7c111277fc542281d3b3
        byte_arr_agent = '.T1F,.T8B,.T08,.T00,.T00,.T00,.T00,.T00,.T04'.replace('.T','0x')
        byte_ldr = byte_arr_agent.split(",")
        byte_list = [int(b_, 16) for b_ in byte_ldr]
        f.write(bytearray(byte_list))
        print("[+] preparing obfuscated byte array")
    with gzip.open('agent.bin', 'rb') as ff:
        buff = ff.read()
    
    with open("agent_unpack.bin", "wb") as fw:
        fw.write(buff)
    print("[+] extracted agent tesla: agent_unpack.bin") 
    return



if __name__ == "__main__":
    main()

